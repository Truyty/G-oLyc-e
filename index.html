<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GéoLycée</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <!-- Import Supabase -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        /* Ensures the app takes the full screen without overflow */
        body, html {
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden;
            font-family: 'Inter', sans-serif;
        }
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap');
        #map {
            height: 100%;
            width: 100%;
            background-color: #f0f0f0;
        }
        .leaflet-tooltip.name-tooltip {
            background-color: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(5px);
            border: none;
            border-radius: 8px;
            padding: 4px 10px;
            font-weight: 600;
            color: #333;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        @keyframes pulse {
            0% { transform: scale(1); opacity: 1; }
            70% { transform: scale(3); opacity: 0; }
            100% { transform: scale(3); opacity: 0; }
        }
        .pulse-ring {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background-color: #3B82F6;
            transform-origin: center;
            animation: pulse 2s ease-out infinite;
            z-index: -1;
            transform: translate(-50%, -50%);
        }
        .switch {
            position: relative;
            display: inline-block;
            width: 48px;
            height: 28px;
        }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider {
            position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0;
            background-color: #ccc; transition: .4s; border-radius: 28px;
        }
        .slider:before {
            position: absolute; content: ""; height: 20px; width: 20px; left: 4px; bottom: 4px;
            background-color: white; transition: .4s; border-radius: 50%;
        }
        input:checked + .slider { background-color: #3B82F6; }
        input:checked + .slider:before { transform: translateX(20px); }
        .bottom-nav {
            position: absolute; bottom: 0; left: 0; right: 0;
            background-color: white; border-top: 1px solid #e5e7eb;
            box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.05); z-index: 1000;
        }
        .nav-content {
            display: flex; justify-content: space-around; align-items: center;
            max-width: 448px; margin-left: auto; margin-right: auto; padding: 0.5rem 1rem;
        }
        .menu-btn-container { 
            display: flex; flex-direction: column; align-items: center; 
            padding: 0.25rem; border-radius: 12px; transition: all 0.2s ease-in-out; 
            color: #4B5563; width: 72px; height: 64px; justify-content: center;
        }
        .menu-btn-container.active-menu { color: #4338CA; }
        .menu-btn-container.active-menu .menu-icon { transform: scale(1.2) translateY(-2px); background-color: #E0E7FF; }
        .menu-btn-container span { 
            font-size: 0.75rem; margin-top: 0.3rem; font-weight: 600; transition: opacity 0.2s ease-in-out;
        }
        .menu-btn-container:not(.active-menu) span { opacity: 0; }
        .menu-icon { padding: 0.75rem; border-radius: 9999px; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
    </style>
    <script type="module">
        const { createClient } = supabase;

        // --- VOS CLÉS SUPABASE ---
        const SUPABASE_URL = 'https://yategsejbcdsqdbypgzc.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlhdGVnc2VqYmNkc3FkYnlwZ3pjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY5NTM0MjIsImV4cCI6MjA3MjUyOTQyMn0.R8vnc1mfbxFlNraqqDp082fxBomKIaTui_3YzZwUIQ0';
        // -------------------------

        const lyceeCenter = [45.96239, 5.34721];

        const appState = {
            map: null,
            supabase: null,
            currentUser: null,
            userMarker: null,
            userAccuracyCircle: null,
            friendMarkers: {},
            friends: {}, // Object to store friend IDs and names
            userName: "",
            isSharing: true,
            watchId: null,
            isMapReady: false,
            isSupabaseReady: false,
            tileLayers: {},
            currentTileLayer: null,
        };

        const ui = {
            loader: document.getElementById('loader'),
            appContainer: document.getElementById('app-container'),
            nameModal: document.getElementById('name-input-modal'),
            nameInput: document.getElementById('name-input'),
            saveNameBtn: document.getElementById('save-name-btn'),
            views: {
                map: document.getElementById('map-view'),
                friends: document.getElementById('friends-view'),
                settings: document.getElementById('settings-view'),
            },
            buttons: {
                map: document.getElementById('map-btn-container'),
                friends: document.getElementById('friends-btn-container'),
                settings: document.getElementById('settings-btn-container'),
            },
            status: document.getElementById('status'),
            userIdDisplay: document.getElementById('user-id-display'),
            copyIdBtn: document.getElementById('copy-id-btn'),
            addFriendInput: document.getElementById('add-friend-input'),
            addFriendBtn: document.getElementById('add-friend-btn'),
            friendsList: document.getElementById('friends-list'),
            shareLocationToggle: document.getElementById('share-location-toggle'),
            showAttributionToggle: document.getElementById('show-attribution-toggle'),
        };
        
        document.addEventListener('DOMContentLoaded', async () => {
            initMap();
            try {
                await requestGeolocationPermission();
                await initSupabase();
                setupEventListeners();
            } catch (error) {
                console.error("Fatal initialization error:", error);
                const loader = document.getElementById('loader');
                loader.innerHTML = `<div class="text-center p-4"><p class="mt-4 text-gray-700 font-semibold">Erreur d'Initialisation</p><p class="mt-2 text-gray-600">${error}</p></div>`;
            }
        });

        const requestGeolocationPermission = () => {
            return new Promise((resolve, reject) => {
                if (!("geolocation" in navigator)) return reject("Géolocalisation non supportée.");
                navigator.geolocation.getCurrentPosition(resolve, (error) => {
                    const messages = { 1: "Accès refusé. Veuillez l'autoriser.", 2: "Position indisponible.", 3: "Délai dépassé." };
                    reject(messages[error.code] || "Erreur de géolocalisation.");
                }, { enableHighAccuracy: true, timeout: 10000, maximumAge: 0 });
            });
        };

        const initSupabase = async () => {
            if (!SUPABASE_URL || !SUPABASE_ANON_KEY) throw new Error("Les clés Supabase ne sont pas configurées.");
            appState.supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
            const { data: { session } } = await appState.supabase.auth.getSession();
            appState.currentUser = session ? session.user : (await appState.supabase.auth.signInAnonymously()).data.user;
            if (!appState.currentUser) throw new Error("Impossible d'authentifier l'utilisateur.");
            appState.isSupabaseReady = true;
            await checkUserSession();
        };

        const initMap = () => {
            appState.map = L.map('map', { center: lyceeCenter, zoom: 19, zoomControl: false, attributionControl: false });
            const attr = '&copy; OpenStreetMap &copy; CARTO';
            appState.tileLayers.withLabels = L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png', { attribution: attr });
            appState.tileLayers.withoutLabels = L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager_nolabels/{z}/{x}/{y}{r}.png', { attribution: attr });
            appState.currentTileLayer = appState.tileLayers.withoutLabels.addTo(appState.map);
            appState.isMapReady = true;
        };
        
        const checkUserSession = async () => {
            const { data, error } = await appState.supabase.from('locations').select('name, is_sharing').eq('user_id', appState.currentUser.id).single();
            if (data && data.name) {
                appState.userName = data.name;
                appState.isSharing = data.is_sharing !== false;
                ui.shareLocationToggle.checked = appState.isSharing;
                await fetchAndDisplayFriends();
                if (appState.isSharing) startLocationTracking();
                listenToFriendLocations();
                ui.loader.classList.add('hidden');
                ui.appContainer.classList.remove('hidden');
                showView('map');
            } else {
                ui.loader.classList.add('hidden');
                ui.nameModal.style.display = 'flex';
            }
        };

        const saveUserName = async () => {
            const name = ui.nameInput.value.trim();
            if (name) {
                appState.userName = name;
                await updateSupabaseLocation({ name: appState.userName, is_sharing: true });
                ui.nameModal.style.display = 'none';
                ui.appContainer.classList.remove('hidden');
                await fetchAndDisplayFriends();
                startLocationTracking();
                listenToFriendLocations();
                showView('map');
            } else {
                showStatus("Veuillez entrer un prénom.", 'warning');
            }
        };

        const startLocationTracking = () => {
            if (appState.watchId !== null) return;
            showStatus("Recherche de votre position...", 'info');
            appState.watchId = navigator.geolocation.watchPosition(
                (pos) => {
                    ui.status.classList.add('hidden');
                    updateSupabaseLocation({ lat: pos.coords.latitude, lng: pos.coords.longitude, is_sharing: true });
                    updateUserMarker(pos.coords.latitude, pos.coords.longitude, pos.coords.accuracy);
                },
                (err) => showStatus("Erreur de géolocalisation.", 'error'),
                { enableHighAccuracy: true, timeout: 10000, maximumAge: 0 }
            );
        };

        const stopLocationTracking = async () => {
            if (appState.watchId !== null) {
                navigator.geolocation.clearWatch(appState.watchId);
                appState.watchId = null;
                await updateSupabaseLocation({ is_sharing: false });
                showStatus("Partage de position arrêté.", 'info');
            }
        };

        const updateSupabaseLocation = async (data) => {
            if (!appState.isSupabaseReady || !appState.currentUser) return;
            try {
                const { error } = await appState.supabase.from('locations').upsert({ ...data, user_id: appState.currentUser.id, timestamp: new Date().toISOString() }, { onConflict: 'user_id' });
                if (error) throw error;
            } catch (e) {
                console.error("Supabase Update Error:", e);
                showStatus("Erreur de synchronisation.", 'error');
            }
        };

        const updateUserMarker = (lat, lng, accuracy) => {
            const latLng = [lat, lng];
            const userIcon = L.divIcon({
                className: 'custom-user-icon',
                html: `<div class="relative w-6 h-6 flex items-center justify-center"><div class="pulse-ring"></div><svg class="w-6 h-6 text-blue-500 filter drop-shadow-lg" viewBox="0 0 24 24" fill="currentColor"><path d="M12,2A10,10,0,1,0,22,12,10,10,0,0,0,12,2Zm0,18a8,8,0,1,1,8-8A8,8,0,0,1,12,20Z"/><circle cx="12" cy="12" r="5" fill="currentColor"/></svg></div>`,
                iconSize: [24, 24], iconAnchor: [12, 12]
            });

            if (!appState.userMarker) {
                appState.userAccuracyCircle = L.circle(latLng, { radius: accuracy, color: '#3B82F6', fillColor: '#3B82F6', fillOpacity: 0.15, weight: 1 }).addTo(appState.map);
                appState.userMarker = L.marker(latLng, { icon: userIcon, zIndexOffset: 1000 }).addTo(appState.map);
                appState.userMarker.bindTooltip(appState.userName, { permanent: true, direction: 'top', offset: [0, -15], className: 'name-tooltip' }).openTooltip();
                appState.map.setView(latLng, 18);
            } else {
                appState.userMarker.setLatLng(latLng);
                appState.userAccuracyCircle.setLatLng(latLng).setRadius(accuracy);
                appState.userMarker.setTooltipContent(appState.userName);
            }
        };

        const listenToFriendLocations = () => {
            appState.supabase.channel('public:locations')
                .on('postgres_changes', { event: '*', schema: 'public', table: 'locations' }, (payload) => {
                    const friendData = payload.new;
                    if (!friendData || friendData.user_id === appState.currentUser.id || !appState.friends[friendData.user_id]) return;
                    
                    const friendId = friendData.user_id;
                    const shouldDisplay = friendData.is_sharing && friendData.lat && friendData.lng;

                    if (!shouldDisplay) {
                        if (appState.friendMarkers[friendId]) {
                            appState.map.removeLayer(appState.friendMarkers[friendId]);
                            delete appState.friendMarkers[friendId];
                        }
                        return;
                    }

                    const friendIcon = L.divIcon({
                        className: 'custom-friend-icon',
                        html: `<svg class="w-8 h-8 text-purple-700 filter drop-shadow-md" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5a2.5 2.5 0 010-5 2.5 2.5 0 010 5z"/></svg>`,
                        iconSize: [32, 32], iconAnchor: [16, 32]
                    });

                    if (appState.friendMarkers[friendId]) {
                        appState.friendMarkers[friendId].setLatLng([friendData.lat, friendData.lng]);
                        appState.friendMarkers[friendId].setTooltipContent(friendData.name || 'Ami');
                    } else {
                        appState.friendMarkers[friendId] = L.marker([friendData.lat, friendData.lng], { icon: friendIcon })
                            .addTo(appState.map)
                            .bindTooltip(friendData.name || 'Ami', { permanent: true, direction: 'top', offset: [0, -35], className: 'name-tooltip' })
                            .openTooltip();
                    }
                })
                .subscribe();
        };

        const addFriend = async () => {
            const friendId = ui.addFriendInput.value.trim();
            if (!friendId) return showStatus("Veuillez entrer un ID.", 'warning');
            if (friendId === appState.currentUser.id) return showStatus("Vous ne pouvez pas vous ajouter vous-même.", 'warning');

            // Check if friend exists
            const { data: friendExists, error: checkError } = await appState.supabase.from('locations').select('name').eq('user_id', friendId).single();
            if (checkError || !friendExists) return showStatus("Cet utilisateur n'existe pas.", 'error');

            const { error } = await appState.supabase.from('friends').insert({ user_id: appState.currentUser.id, friend_id: friendId });
            if (error) {
                if (error.code === '23505') showStatus("Cet ami est déjà dans votre liste.", 'warning');
                else showStatus("Erreur lors de l'ajout.", 'error');
            } else {
                showStatus(`${friendExists.name} a été ajouté(e) !`, 'success');
                ui.addFriendInput.value = '';
                await fetchAndDisplayFriends(); // Refresh the list
            }
        };

        const fetchAndDisplayFriends = async () => {
            const { data: friendRelations, error } = await appState.supabase.from('friends').select('friend_id').eq('user_id', appState.currentUser.id);
            if (error) return console.error("Error fetching friends:", error);

            const friendIds = friendRelations.map(r => r.friend_id);
            if (friendIds.length === 0) {
                renderFriendList();
                return;
            }

            const { data: friendsData, error: namesError } = await appState.supabase.from('locations').select('user_id, name').in('user_id', friendIds);
            if (namesError) return console.error("Error fetching friend names:", namesError);
            
            appState.friends = {}; // Reset friends list
            friendsData.forEach(friend => {
                appState.friends[friend.user_id] = friend.name;
            });
            renderFriendList();
        };

        const renderFriendList = () => {
            ui.friendsList.innerHTML = ''; // Clear current list
            const friendIds = Object.keys(appState.friends);

            if (friendIds.length === 0) {
                ui.friendsList.innerHTML = `<li class="text-center text-gray-500 py-4">Ajoutez des amis avec leur ID.</li>`;
                return;
            }

            friendIds.forEach(id => {
                const name = appState.friends[id];
                const li = document.createElement('li');
                li.className = 'flex items-center justify-between bg-white p-3 rounded-lg shadow-sm hover:bg-gray-50 cursor-pointer';
                li.innerHTML = `<span class="font-medium text-gray-700">${name}</span><svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"></path></svg>`;
                li.addEventListener('click', () => centerOnFriend(id));
                ui.friendsList.appendChild(li);
            });
        };

        const centerOnFriend = (friendId) => {
            const friendMarker = appState.friendMarkers[friendId];
            if (friendMarker) {
                showView('map');
                appState.map.setView(friendMarker.getLatLng(), 18, { animate: true, pan: { duration: 1 } });
                showStatus(`Centrage sur ${appState.friends[friendId]}`, 'info');
            } else {
                showStatus(`${appState.friends[friendId]} ne partage pas sa position.`, 'warning');
            }
        };
        
        const setupEventListeners = () => {
            ui.saveNameBtn.addEventListener('click', saveUserName);
            ui.nameInput.addEventListener('keypress', (e) => { if (e.key === 'Enter') saveUserName(); });
            ui.addFriendBtn.addEventListener('click', addFriend);
            
            ui.buttons.friends.addEventListener('click', () => showView('friends'));
            ui.buttons.settings.addEventListener('click', () => showView('settings'));
            ui.buttons.map.addEventListener('click', () => {
                if (!ui.views.map.classList.contains('hidden')) {
                    appState.map.setView(lyceeCenter, 19, { animate: true, pan: { duration: 1 } });
                    showStatus("Vue réinitialisée sur le lycée", 'info');
                } else {
                    showView('map');
                }
            });

            ui.copyIdBtn.addEventListener('click', () => {
                navigator.clipboard.writeText(appState.currentUser.id).then(() => {
                    showStatus("ID copié dans le presse-papiers !", 'success');
                });
            });
            
            ui.shareLocationToggle.addEventListener('change', (e) => {
                appState.isSharing = e.target.checked;
                if (appState.isSharing) startLocationTracking();
                else stopLocationTracking();
            });

            ui.showAttributionToggle.addEventListener('change', (e) => {
                const showLabels = e.target.checked;
                appState.map.removeLayer(appState.currentTileLayer);
                appState.currentTileLayer = showLabels ? appState.tileLayers.withLabels : appState.tileLayers.withoutLabels;
                appState.currentTileLayer.addTo(appState.map);
                if(showLabels) L.control.attribution({ position: 'bottomleft' }).addTo(appState.map);
                else if (appState.map.attributionControl) appState.map.removeControl(appState.map.attributionControl);
            });
        };

        const showView = (viewName) => {
            Object.values(ui.views).forEach(v => v.classList.add('hidden'));
            ui.views[viewName].classList.remove('hidden');

            document.querySelectorAll('.menu-btn-container').forEach(el => el.classList.remove('active-menu'));
            ui.buttons[viewName].classList.add('active-menu');
            
            if (viewName === 'map') appState.map.invalidateSize();
            if (viewName === 'friends') {
                ui.userIdDisplay.textContent = appState.currentUser ? appState.currentUser.id : "...";
                fetchAndDisplayFriends();
            }
        };

        const showStatus = (message, type = 'info') => {
            const colors = {
                info: 'bg-blue-100 text-blue-800', success: 'bg-green-100 text-green-800',
                warning: 'bg-yellow-100 text-yellow-800', error: 'bg-red-100 text-red-800',
            };
            ui.status.textContent = message;
            ui.status.className = `absolute top-4 left-1/2 -translate-x-1/2 text-center text-sm font-medium p-3 rounded-xl shadow-lg transition-all duration-300 z-[1001] ${colors[type]}`;
            ui.status.classList.remove('hidden');
            setTimeout(() => ui.status.classList.add('hidden'), 3000);
        };
    </script>
</head>
<body class="bg-gray-100 antialiased">
    
    <!-- Loader -->
    <div id="loader" class="fixed inset-0 bg-white flex flex-col items-center justify-center z-[2000]">
        <svg class="animate-spin h-10 w-10 text-blue-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
        </svg>
        <p class="mt-4 text-gray-600">Chargement de GéoLycée...</p>
    </div>

    <!-- Name Input Modal -->
    <div id="name-input-modal" class="fixed inset-0 bg-gray-900 bg-opacity-50 backdrop-blur-sm z-[1500] items-center justify-center p-4" style="display: none;">
        <div class="modal-content bg-white p-6 sm:p-8 rounded-2xl text-center w-full max-w-sm shadow-2xl">
            <h2 class="text-2xl font-bold text-gray-800 mb-2">Bienvenue sur GéoLycée</h2>
            <p class="text-gray-600 mb-6">Entrez votre prénom pour apparaître sur la carte.</p>
            <input id="name-input" type="text" placeholder="Votre prénom..." class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 mb-4 text-center">
            <button id="save-name-btn" class="w-full bg-blue-500 text-white p-3 rounded-lg font-bold hover:bg-blue-600 transition-all duration-200 shadow-md hover:shadow-lg">
                Commencer le partage
            </button>
        </div>
    </div>

    <!-- Main App Container -->
    <div id="app-container" class="relative w-full h-full flex flex-col hidden">
        <header class="absolute top-0 inset-x-0 p-4 flex items-center justify-center z-[1000] pointer-events-none">
            <div class="bg-white/80 backdrop-blur-md px-6 py-3 rounded-full shadow-lg">
                <h1 class="text-xl font-bold text-gray-800 tracking-tight">GéoLycée</h1>
            </div>
        </header>

        <main class="flex-grow w-full h-full relative overflow-hidden">
            <div id="map-view" class="w-full h-full">
                <div id="map"></div>
                <div id="status" class="hidden"></div>
            </div>
            <div id="friends-view" class="w-full h-full bg-gray-50 p-6 pt-24 overflow-y-auto hidden">
                <div class="max-w-md mx-auto">
                    <h2 class="text-3xl font-bold text-gray-800 mb-6">Amis</h2>
                    
                    <!-- Add Friend Section -->
                    <div class="bg-white p-4 rounded-xl shadow-sm border border-gray-200 mb-6">
                        <h3 class="font-semibold text-gray-700 mb-2">Ajouter un ami</h3>
                        <div class="flex items-center gap-2">
                            <input id="add-friend-input" type="text" placeholder="Collez l'ID de votre ami..." class="flex-grow p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm">
                            <button id="add-friend-btn" class="bg-blue-500 text-white p-2 rounded-md hover:bg-blue-600 transition active:scale-95">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path></svg>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Friend List -->
                    <div>
                        <h3 class="font-semibold text-gray-700 mb-3">Ma liste d'amis</h3>
                        <ul id="friends-list" class="space-y-2">
                            <!-- Friends will be dynamically inserted here -->
                        </ul>
                    </div>

                    <!-- Share ID Section -->
                    <div class="bg-white p-4 rounded-xl shadow-sm border border-gray-200 mt-8">
                        <h3 class="font-semibold text-gray-700 mb-2">Votre ID de partage</h3>
                        <p class="text-sm text-gray-500 mb-3">Donnez cet ID unique à vos amis pour qu'ils vous ajoutent.</p>
                        <div class="flex items-center gap-2 bg-gray-100 p-2 rounded-lg">
                            <p id="user-id-display" class="text-xs font-mono text-gray-600 truncate flex-grow"></p>
                            <button id="copy-id-btn" class="bg-gray-200 text-gray-700 p-2 rounded-md hover:bg-gray-300 transition active:scale-95">
                                 <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            <div id="settings-view" class="w-full h-full bg-gray-50 p-6 pt-24 overflow-y-auto hidden">
                 <div class="max-w-md mx-auto">
                    <h2 class="text-3xl font-bold text-gray-800 mb-6">Paramètres</h2>
                     <div class="bg-white p-4 rounded-xl shadow-sm border border-gray-200">
                         <div class="flex items-center justify-between">
                             <div>
                                 <h3 class="font-semibold text-gray-700">Partager ma position</h3>
                                 <p class="text-sm text-gray-500">Permet à vos amis de voir votre position.</p>
                             </div>
                             <label class="switch">
                                 <input type="checkbox" id="share-location-toggle" checked>
                                 <span class="slider"></span>
                             </label>
                         </div>
                     </div>
                     <div class="bg-white p-4 rounded-xl shadow-sm border border-gray-200 mt-4">
                         <div class="flex items-center justify-between">
                             <div>
                                 <h3 class="font-semibold text-gray-700">Noms des rues & Légende</h3>
                                 <p class="text-sm text-gray-500">Affiche les détails et les crédits.</p>
                             </div>
                             <label class="switch">
                                 <input type="checkbox" id="show-attribution-toggle">
                                 <span class="slider"></span>
                             </label>
                         </div>
                     </div>
                 </div>
            </div>
        </main>
        
        <nav class="bottom-nav">
            <div class="nav-content">
                <button id="friends-btn-container" class="menu-btn-container">
                    <div class="menu-icon">
                        <svg class="h-6 w-6" fill="currentColor" viewBox="0 0 24 24"><path d="M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z"/></svg>
                    </div>
                    <span>Amis</span>
                </button>
                <button id="map-btn-container" class="menu-btn-container">
                    <div class="menu-icon">
                        <svg class="h-6 w-6" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5a2.5 2.5 0 010-5 2.5 2.5 0 010 5z"/></svg>
                    </div>
                    <span>Carte</span>
                </button>
                <button id="settings-btn-container" class="menu-btn-container">
                    <div class="menu-icon">
                        <svg class="h-6 w-6" fill="currentColor" viewBox="0 0 24 24"><path d="M19.14,12.94c0.04-0.3,0.06-0.61,0.06-0.94c0-0.32-0.02-0.64-0.07-0.94l2.03-1.58c0.18-0.14,0.23-0.41,0.12-0.61 l-1.92-3.32c-0.12-0.22-0.37-0.29-0.59-0.22l-2.39,0.96c-0.5-0.38-1.03-0.7-1.62-0.94L14.4,2.81c-0.04-0.24-0.24-0.41-0.48-0.41 h-3.84c-0.24,0-0.44,0.17-0.48,0.41L9.22,5.72C8.63,5.96,8.1,6.29,7.6,6.67L5.21,5.71C4.99,5.62,4.74,5.69,4.62,5.91L2.7,9.23 c-0.11,0.2-0.06,0.47,0.12,0.61L4.85,11.4c-0.05,0.3-0.07,0.62-0.07,0.94c0,0.32,0.02,0.64,0.07,0.94l-2.03,1.58 c-0.18,0.14-0.23,0.41-0.12,0.61l1.92,3.32c0.12,0.22,0.37,0.29,0.59,0.22l2.39-0.96c0.5,0.38,1.03,0.7,1.62,0.94l0.38,2.91 c0.04,0.24,0.24,0.41,0.48,0.41h3.84c0.24,0,0.44-0.17-0.48,0.41l0.38-2.91c0.59-0.24,1.12-0.56,1.62-0.94l2.39,0.96 c0.22,0.08,0.47,0.01,0.59-0.22l1.92-3.32c0.12-0.2,0.07-0.47-0.12-0.61L19.14,12.94z M12,15.6c-1.98,0-3.6-1.62-3.6-3.6 s1.62-3.6,3.6-3.6s3.6,1.62,3.6,3.6S13.98,15.6,12,15.6z"/></svg>
                    </div>
                    <span>Paramètres</span>
                </button>
            </div>
        </nav>
    </div>
</body>
</html>

